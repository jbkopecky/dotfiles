#! /bin/bash

target="${HOME}/.themes/mad/openbox-3/colors.themerc"
colors="${HOME}/.cache/wal/colors.sh"

newline="
"

get_args() {
    while getopts ":chi:o:qrt" opt; do
        case "$opt" in
            "r") reload="on";;
            "?")
                printf "%s\n" "Invalid option: -$OPTARG" >&2
                exit 1
            ;;

            ":")
                printf "%s\n" "Option -$OPTARG requires an argument." >&2
                exit 1
            ;;
        esac
    done
}

out() {
    [[ "$quiet" != "on" ]] && printf "%s\n" "$1" >&2
}

set_option() {
    ob_colors+="${1}: ${2}${newline}"
}

build_conf() {
    if [[ -f "$colors" ]]; then
        source "$colors"
        set_option "window.active.title.bg.color" ${color2}
        set_option "window.active.border.color"   ${color2}

        set_option "window.inactive.title.bg.color" ${color3}
        set_option "window.inactive.border.color"   ${color3}

        set_option "window.active.label.text.color"   ${color15}
        set_option "window.inactive.label.text.color" ${color15}
        set_option "window.*.button.*.image.color"    ${color15}

        set_option "menu*.bg.color"       ${color15}
        set_option "menu.separator.color" ${color15}
        set_option "menu.border.color"    ${color15}
        set_option "menu*.text.color"     ${color0}
        
        # set_option "border.width" 2
    else
        out "No colors.sh source file found !"
        exit 1
    fi
}

export_colors() {
    printf "%s\n%s" "# Colors generated by obco " "$ob_colors"
    out "* Exported Colors !"
}

reload_openbox() {
    killall -USR2 openbox >&2
    out "* Reloaded Openbox !"
}

main() {
    # get args
    get_args "$@"

    # Build colors
    build_conf

    # Export colors
    export_colors > "${target}"

    # Reload !
    [[ "$reload" == "on" ]] && reload_openbox
}

main "$@"
